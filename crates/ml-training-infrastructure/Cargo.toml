[package]
name = "ml-training-infrastructure"
version = "0.1.0"
edition = "2021"

# Standalone crate
[workspace]

[dependencies]
# Core dependencies
async-trait = "0.1"
tokio = { version = "1.40", features = ["full"] }
futures = "0.3"
rayon = "1.10"
crossbeam = "0.8"
parking_lot = "0.12"

# Scientific computing
ndarray = { version = "0.15", features = ["serde", "rayon"] }
ndarray-rand = "0.14"
ndarray-linalg = { version = "0.16", optional = true }
nalgebra = "0.32"
num-traits = "0.2"
statrs = "0.17"

# Machine Learning
lightgbm = "0.2"
# xgboost = "0.1"  # commented out due to bindgen version conflict with rocksdb
smartcore = { version = "0.3", features = ["serde"] }
linfa = "0.7"
linfa-trees = "0.7"
linfa-svm = "0.7"
linfa-nn = "0.7"

# Deep Learning
candle-core = { workspace = true, features = ["cuda"] }
candle-nn = { workspace = true }
candle-transformers = "0.8.0"
# burn = { version = "0.14", features = ["ndarray", "wgpu"] }  # commented out due to libsqlite3-sys version conflict
tch = { workspace = true, optional = true }  # Using workspace version - resolves torch-sys native library conflict

# GPU Support
wgpu = { version = "26.0", features = ["spirv"] }
pollster = "0.3"
bytemuck = { version = "1.14", features = ["derive"] }

# Data handling
arrow = "51.0"
parquet = "51.0"
polars = { version = "0.37", features = ["lazy", "parquet", "temporal"] }
datafusion = { workspace = true }

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
bincode = "1.3"
rmp-serde = "1.1"

# Experiment tracking
sqlx = { workspace = true, features = ["runtime-tokio-native-tls", "uuid", "chrono"] }
uuid = { version = "1.8", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }

# Metrics and monitoring
prometheus = "0.13"
metrics = "0.22"
metrics-exporter-prometheus = "0.13"

# Visualization
plotters = { version = "0.3", features = ["bitmap_backend", "svg_backend"] }
plotly = { version = "0.8", features = ["kaleido"] }

# Optimization
argmin = "0.9"
argmin-math = { version = "0.3", features = ["ndarray_latest"] }
approx = "0.5"

# Utilities
log = "0.4"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }
thiserror = "1.0"
anyhow = "1.0"
derive_builder = "0.13"
dashmap = "5.5"
once_cell = "1.19"
moka = { version = "0.12", features = ["future"] }

# Internal crates
ats-core = { path = "../ats-core" }
neural-forecast = { path = "../neural-forecast" }
cdfa-core = { path = "../cdfa-core" }
quantum-core = { path = "../quantum-core", optional = true }
performance-engine = { path = "../performance-engine" }
memory-manager = { path = "../memory-manager" }

[dev-dependencies]
criterion = { version = "0.5", features = ["html_reports", "async_tokio"] }
proptest = "1.4"
rstest = "0.18"
tempfile = "3.10"
mockall = "0.12"

[features]
default = ["gpu", "quantum"]
gpu = ["candle-core/cuda"]  # removed burn/wgpu due to dependency conflict
quantum = ["quantum-core"]
pytorch = ["tch"]
mkl = ["ndarray-linalg"]

[[bench]]
name = "training_benchmarks"
harness = false

[[bench]]
name = "model_benchmarks"
harness = false