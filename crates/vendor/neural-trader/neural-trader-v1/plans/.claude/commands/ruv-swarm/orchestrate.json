{
  "$schema": "https://claude.ai/schema/commands/v1.0.0",
  "name": "orchestrate",
  "description": "Coordinate and distribute tasks across the agent swarm for optimal trading execution",
  "version": "1.0.0",
  "category": "swarm-coordination",
  "tags": ["orchestration", "task-distribution", "coordination", "workflow"],
  
  "command": {
    "syntax": "orchestrate [options] <workflow-file> | <task>",
    "aliases": ["coordinate", "distribute"],
    "examples": [
      {
        "description": "Orchestrate a market analysis workflow",
        "command": "orchestrate --swarm trading-swarm-01 market-analysis.workflow"
      },
      {
        "description": "Execute immediate trading decision",
        "command": "orchestrate --priority high --task \"analyze AAPL news sentiment\""
      },
      {
        "description": "Orchestrate with load balancing and fault tolerance",
        "command": "orchestrate --balance round-robin --fault-tolerant workflow.yaml"
      }
    ]
  },
  
  "parameters": {
    "required": [
      {
        "name": "input",
        "type": "string",
        "description": "Workflow file path or inline task definition",
        "validation": {
          "oneOf": [
            {
              "pattern": "^.*\\.(workflow|yaml|yml|json)$",
              "fileExists": true
            },
            {
              "minLength": 5,
              "maxLength": 500
            }
          ]
        }
      }
    ],
    
    "optional": [
      {
        "name": "swarm",
        "type": "string",
        "short": "s",
        "long": "swarm",
        "description": "Target swarm identifier",
        "default": "active-swarm"
      },
      {
        "name": "priority",
        "type": "string",
        "short": "p",
        "long": "priority",
        "description": "Task priority level",
        "default": "normal",
        "choices": ["low", "normal", "high", "critical"]
      },
      {
        "name": "balance",
        "type": "string",
        "short": "b",
        "long": "balance",
        "description": "Load balancing strategy",
        "default": "intelligent",
        "choices": ["round-robin", "least-loaded", "intelligent", "sticky", "random"]
      },
      {
        "name": "timeout",
        "type": "integer",
        "short": "t",
        "long": "timeout",
        "description": "Task execution timeout in seconds",
        "default": 600
      },
      {
        "name": "parallel-tasks",
        "type": "integer",
        "long": "parallel-tasks",
        "description": "Maximum parallel tasks per agent",
        "default": 3,
        "validation": {
          "min": 1,
          "max": 10
        }
      },
      {
        "name": "fault-tolerant",
        "type": "boolean",
        "short": "f",
        "long": "fault-tolerant",
        "description": "Enable fault tolerance with automatic retries",
        "default": true
      },
      {
        "name": "checkpoint",
        "type": "boolean",
        "long": "checkpoint",
        "description": "Enable workflow checkpointing",
        "default": false
      },
      {
        "name": "metrics",
        "type": "boolean",
        "short": "m",
        "long": "metrics",
        "description": "Collect detailed execution metrics",
        "default": true
      }
    ]
  },
  
  "workflow": {
    "schema": {
      "type": "object",
      "required": ["name", "tasks"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Workflow identifier"
        },
        "version": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        
        "tasks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "type", "action"],
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^[a-zA-Z0-9-_]+$"
              },
              "type": {
                "type": "string",
                "enum": ["analysis", "trading", "monitoring", "risk-assessment", "data-collection"]
              },
              "action": {
                "type": "string",
                "description": "Specific action to perform"
              },
              "agent_type": {
                "type": "string",
                "description": "Preferred agent type for this task"
              },
              "mcp_tools": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Required MCP tools for this task"
              },
              "parameters": {
                "type": "object",
                "additionalProperties": true
              },
              "dependencies": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Task IDs that must complete before this task"
              },
              "conditions": {
                "type": "object",
                "properties": {
                  "if": {
                    "type": "string"
                  },
                  "then": {
                    "type": "string"
                  },
                  "else": {
                    "type": "string"
                  }
                }
              },
              "retry": {
                "type": "object",
                "properties": {
                  "max_attempts": {
                    "type": "integer"
                  },
                  "backoff": {
                    "type": "string"
                  }
                }
              },
              "timeout": {
                "type": "integer"
              }
            }
          }
        },
        
        "orchestration": {
          "type": "object",
          "properties": {
            "strategy": {
              "type": "string",
              "enum": ["sequential", "parallel", "dag", "pipeline"]
            },
            "constraints": {
              "type": "object",
              "properties": {
                "max_parallel": {
                  "type": "integer"
                },
                "resource_limits": {
                  "type": "object"
                }
              }
            },
            "error_handling": {
              "type": "string",
              "enum": ["fail-fast", "continue", "rollback"]
            }
          }
        },
        
        "triggers": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["schedule", "event", "condition"]
              },
              "config": {
                "type": "object"
              }
            }
          }
        }
      }
    }
  },
  
  "execution": {
    "strategies": {
      "round-robin": {
        "description": "Distribute tasks evenly across agents",
        "algorithm": "Sequential rotation through available agents"
      },
      "least-loaded": {
        "description": "Assign to agent with lowest current load",
        "algorithm": "Dynamic load monitoring and assignment"
      },
      "intelligent": {
        "description": "AI-driven optimal task distribution",
        "algorithm": "ML-based agent capability and load analysis"
      },
      "sticky": {
        "description": "Maintain task-agent affinity",
        "algorithm": "Hash-based consistent assignment"
      },
      "random": {
        "description": "Random agent selection",
        "algorithm": "Uniform random distribution"
      }
    },
    
    "phases": [
      {
        "name": "parsing",
        "description": "Parse and validate workflow/task",
        "steps": [
          "Load workflow definition or parse task",
          "Validate against schema",
          "Resolve dependencies",
          "Check agent capabilities"
        ]
      },
      {
        "name": "planning",
        "description": "Create execution plan",
        "steps": [
          "Build dependency graph",
          "Identify parallelization opportunities",
          "Calculate resource requirements",
          "Create task schedule"
        ]
      },
      {
        "name": "distribution",
        "description": "Distribute tasks to agents",
        "steps": [
          "Query agent availability",
          "Apply load balancing strategy",
          "Assign tasks to agents",
          "Setup monitoring"
        ]
      },
      {
        "name": "execution",
        "description": "Execute distributed tasks",
        "steps": [
          "Send tasks to agents",
          "Monitor execution progress",
          "Handle inter-task communication",
          "Manage checkpoints"
        ]
      },
      {
        "name": "collection",
        "description": "Collect and aggregate results",
        "steps": [
          "Gather task results",
          "Validate outputs",
          "Aggregate data",
          "Generate summary"
        ]
      }
    ],
    
    "fault_tolerance": {
      "mechanisms": [
        {
          "type": "retry",
          "description": "Automatic task retry on failure",
          "config": {
            "max_retries": 3,
            "backoff": "exponential",
            "retry_delay": 1000
          }
        },
        {
          "type": "failover",
          "description": "Reassign task to different agent",
          "config": {
            "health_check_interval": 5000,
            "failover_timeout": 30000
          }
        },
        {
          "type": "checkpoint",
          "description": "Save intermediate state",
          "config": {
            "checkpoint_interval": 60000,
            "storage": "distributed"
          }
        }
      ]
    }
  },
  
  "monitoring": {
    "metrics": [
      {
        "name": "task_throughput",
        "type": "gauge",
        "unit": "tasks/second",
        "description": "Number of tasks completed per second"
      },
      {
        "name": "task_latency",
        "type": "histogram",
        "unit": "milliseconds",
        "description": "Task execution latency distribution"
      },
      {
        "name": "agent_utilization",
        "type": "gauge",
        "unit": "percentage",
        "description": "Agent CPU/memory utilization"
      },
      {
        "name": "queue_depth",
        "type": "gauge",
        "unit": "count",
        "description": "Number of tasks waiting in queue"
      }
    ],
    
    "events": [
      "task_started",
      "task_completed",
      "task_failed",
      "agent_overloaded",
      "dependency_resolved"
    ]
  },
  
  "output": {
    "success": {
      "format": "json",
      "fields": {
        "workflow_id": "Unique workflow execution ID",
        "status": "Overall execution status",
        "tasks": {
          "total": "Total number of tasks",
          "completed": "Successfully completed tasks",
          "failed": "Failed tasks",
          "pending": "Pending tasks"
        },
        "results": "Aggregated task results",
        "metrics": "Execution metrics summary",
        "duration": "Total execution time"
      }
    },
    "streaming": {
      "enabled": true,
      "format": "jsonl",
      "events": [
        "task_assignment",
        "task_progress",
        "task_completion",
        "metric_update"
      ]
    }
  },
  
  "integration": {
    "mcp_tools": [
      "mcp__ai-news-trader__quick_analysis",
      "mcp__ai-news-trader__neural_forecast",
      "mcp__ai-news-trader__risk_analysis",
      "mcp__ai-news-trader__execute_multi_asset_trade"
    ],
    "communication": {
      "protocols": ["websocket", "grpc", "http"],
      "serialization": ["json", "protobuf", "msgpack"]
    }
  }
}