{
  "$schema": "https://claude.ai/schema/commands/v1.0.0",
  "name": "terminate",
  "description": "Gracefully shutdown swarm operations with proper cleanup and state preservation",
  "version": "1.0.0",
  "category": "swarm-lifecycle",
  "tags": ["shutdown", "cleanup", "termination", "lifecycle"],
  
  "command": {
    "syntax": "terminate [options] <swarm-id> | --all",
    "aliases": ["shutdown", "stop", "halt"],
    "examples": [
      {
        "description": "Graceful shutdown with state preservation",
        "command": "terminate --graceful --save-state trading-swarm-01"
      },
      {
        "description": "Emergency shutdown all swarms",
        "command": "terminate --all --emergency --reason \"Market anomaly detected\""
      },
      {
        "description": "Scheduled shutdown with position closing",
        "command": "terminate --close-positions --timeout 300 production-swarm"
      }
    ]
  },
  
  "parameters": {
    "required": [
      {
        "name": "target",
        "type": "string",
        "description": "Swarm ID to terminate or --all for all swarms",
        "validation": {
          "oneOf": [
            {
              "pattern": "^[a-zA-Z0-9-_]+$"
            },
            {
              "const": "--all"
            }
          ]
        }
      }
    ],
    
    "optional": [
      {
        "name": "mode",
        "type": "string",
        "short": "m",
        "long": "mode",
        "description": "Shutdown mode",
        "default": "graceful",
        "choices": ["graceful", "immediate", "emergency", "scheduled"]
      },
      {
        "name": "timeout",
        "type": "integer",
        "short": "t",
        "long": "timeout",
        "description": "Maximum time for graceful shutdown (seconds)",
        "default": 300,
        "validation": {
          "min": 0,
          "max": 3600
        }
      },
      {
        "name": "save-state",
        "type": "boolean",
        "short": "s",
        "long": "save-state",
        "description": "Save current state before shutdown",
        "default": true
      },
      {
        "name": "close-positions",
        "type": "boolean",
        "short": "c",
        "long": "close-positions",
        "description": "Close all open trading positions",
        "default": false
      },
      {
        "name": "reason",
        "type": "string",
        "short": "r",
        "long": "reason",
        "description": "Reason for termination (for audit log)",
        "maxLength": 500
      },
      {
        "name": "force",
        "type": "boolean",
        "short": "f",
        "long": "force",
        "description": "Force termination even with active operations",
        "default": false
      },
      {
        "name": "preserve-logs",
        "type": "boolean",
        "long": "preserve-logs",
        "description": "Archive logs before termination",
        "default": true
      },
      {
        "name": "notify",
        "type": "array",
        "short": "n",
        "long": "notify",
        "description": "Notification channels for termination alerts",
        "elementType": "string",
        "choices": ["email", "slack", "webhook", "pagerduty"]
      }
    ]
  },
  
  "shutdown_modes": {
    "graceful": {
      "description": "Orderly shutdown with proper cleanup",
      "phases": [
        "stop_accepting_new_tasks",
        "complete_active_tasks",
        "close_positions_if_requested",
        "save_state",
        "cleanup_resources",
        "final_verification"
      ],
      "timeout_behavior": "escalate_to_immediate"
    },
    "immediate": {
      "description": "Quick shutdown with basic cleanup",
      "phases": [
        "stop_all_operations",
        "save_critical_state",
        "terminate_agents",
        "basic_cleanup"
      ],
      "timeout_behavior": "force_terminate"
    },
    "emergency": {
      "description": "Fastest possible shutdown for critical situations",
      "phases": [
        "halt_trading",
        "dump_memory_state",
        "kill_processes"
      ],
      "timeout_behavior": "immediate"
    },
    "scheduled": {
      "description": "Planned shutdown with full preparation",
      "phases": [
        "announce_shutdown",
        "wind_down_operations",
        "transfer_responsibilities",
        "graceful_shutdown"
      ],
      "timeout_behavior": "extend_if_needed"
    }
  },
  
  "cleanup_operations": {
    "tasks": [
      {
        "name": "complete_pending_tasks",
        "description": "Finish or safely abort pending operations",
        "priority": 1,
        "timeout": 60
      },
      {
        "name": "close_trading_positions",
        "description": "Close all open trading positions",
        "priority": 2,
        "timeout": 120,
        "conditional": "close-positions == true"
      },
      {
        "name": "save_agent_states",
        "description": "Persist agent states for recovery",
        "priority": 3,
        "timeout": 30
      },
      {
        "name": "export_metrics",
        "description": "Export performance metrics and analytics",
        "priority": 4,
        "timeout": 45
      },
      {
        "name": "archive_logs",
        "description": "Compress and archive log files",
        "priority": 5,
        "timeout": 60,
        "conditional": "preserve-logs == true"
      },
      {
        "name": "cleanup_resources",
        "description": "Release system resources",
        "priority": 6,
        "timeout": 30
      }
    ],
    
    "resource_cleanup": {
      "memory": {
        "shared_memory": "unlink",
        "cache": "flush",
        "buffers": "clear"
      },
      "network": {
        "connections": "close",
        "sockets": "shutdown",
        "ports": "release"
      },
      "storage": {
        "temp_files": "delete",
        "locks": "release",
        "pid_files": "remove"
      }
    }
  },
  
  "state_preservation": {
    "components": [
      {
        "name": "agent_state",
        "critical": true,
        "format": "json",
        "compression": true
      },
      {
        "name": "trading_positions",
        "critical": true,
        "format": "json",
        "encryption": true
      },
      {
        "name": "strategy_parameters",
        "critical": false,
        "format": "yaml"
      },
      {
        "name": "performance_metrics",
        "critical": false,
        "format": "csv"
      },
      {
        "name": "neural_models",
        "critical": true,
        "format": "binary",
        "versioned": true
      }
    ],
    
    "storage": {
      "location": "/var/lib/swarm/shutdown-states",
      "naming": "swarm-{id}-{timestamp}",
      "retention": "30d",
      "redundancy": 3
    }
  },
  
  "position_management": {
    "strategies": {
      "market_close": {
        "description": "Close all positions at market price",
        "risk": "high",
        "speed": "fast"
      },
      "limit_close": {
        "description": "Close with limit orders",
        "risk": "medium",
        "speed": "slow"
      },
      "transfer": {
        "description": "Transfer to another system",
        "risk": "low",
        "speed": "medium"
      },
      "hedge": {
        "description": "Hedge positions before shutdown",
        "risk": "low",
        "speed": "medium"
      }
    },
    
    "validation": {
      "pre_close": [
        "verify_market_hours",
        "check_liquidity",
        "calculate_impact"
      ],
      "post_close": [
        "confirm_executions",
        "reconcile_positions",
        "verify_zero_exposure"
      ]
    }
  },
  
  "monitoring": {
    "shutdown_metrics": [
      "shutdown_duration",
      "tasks_completed",
      "tasks_aborted",
      "positions_closed",
      "data_saved",
      "resources_released"
    ],
    
    "health_checks": {
      "during_shutdown": {
        "interval": 5,
        "timeout": 2,
        "escalation": "force_terminate"
      },
      "post_shutdown": {
        "verify": [
          "all_processes_terminated",
          "all_resources_released",
          "no_orphaned_data"
        ]
      }
    }
  },
  
  "recovery": {
    "information": {
      "state_location": "Path to saved state files",
      "shutdown_log": "Detailed shutdown log location",
      "recovery_instructions": "Steps to restart swarm",
      "checkpoint_id": "Last valid checkpoint identifier"
    },
    
    "artifacts": [
      {
        "type": "state_snapshot",
        "format": "tar.gz",
        "includes": ["configs", "states", "positions"]
      },
      {
        "type": "shutdown_report",
        "format": "json",
        "includes": ["metrics", "errors", "timeline"]
      },
      {
        "type": "recovery_script",
        "format": "bash",
        "customized": true
      }
    ]
  },
  
  "notifications": {
    "events": [
      {
        "trigger": "shutdown_initiated",
        "channels": ["all"],
        "priority": "high"
      },
      {
        "trigger": "positions_closed",
        "channels": ["email", "slack"],
        "priority": "high"
      },
      {
        "trigger": "shutdown_completed",
        "channels": ["all"],
        "priority": "medium"
      },
      {
        "trigger": "shutdown_failed",
        "channels": ["all"],
        "priority": "critical"
      }
    ],
    
    "templates": {
      "email": {
        "subject": "Swarm {swarm_id} Shutdown {status}",
        "body": "shutdown_email_template.html"
      },
      "slack": {
        "format": "markdown",
        "channel": "#swarm-alerts"
      }
    }
  },
  
  "output": {
    "success": {
      "format": "json",
      "fields": {
        "shutdown_id": "Unique shutdown operation ID",
        "swarm_id": "Terminated swarm identifier",
        "status": "Shutdown completion status",
        "summary": {
          "start_time": "Shutdown start timestamp",
          "end_time": "Shutdown completion timestamp",
          "duration": "Total shutdown duration",
          "mode": "Shutdown mode used"
        },
        "cleanup": {
          "tasks_completed": "Number of cleanup tasks completed",
          "positions_closed": "Trading positions closed",
          "state_saved": "State preservation status",
          "resources_released": "Resources cleanup status"
        },
        "recovery": {
          "state_location": "Path to saved state",
          "checkpoint_id": "Recovery checkpoint ID",
          "instructions": "Recovery instructions path"
        }
      }
    },
    "progress": {
      "format": "streaming",
      "events": [
        "phase_started",
        "task_completed",
        "warning_issued",
        "error_occurred"
      ]
    }
  },
  
  "integration": {
    "mcp_tools": [
      "mcp__ai-news-trader__get_portfolio_status",
      "mcp__ai-news-trader__terminate",
      "mcp__ai-news-trader__get_system_metrics"
    ],
    "hooks": {
      "pre_shutdown": "Execute before shutdown begins",
      "post_shutdown": "Execute after shutdown completes",
      "on_error": "Execute if shutdown fails"
    }
  },
  
  "safety": {
    "guards": [
      {
        "name": "active_trades_check",
        "description": "Prevent shutdown with critical trades",
        "override": "force"
      },
      {
        "name": "market_hours_check",
        "description": "Warn if shutting down during market hours",
        "override": "force"
      },
      {
        "name": "position_risk_check",
        "description": "Evaluate risk of open positions",
        "override": "emergency"
      }
    ],
    
    "rollback": {
      "enabled": true,
      "trigger": "critical_error",
      "actions": [
        "restore_state",
        "restart_critical_agents",
        "alert_operators"
      ]
    }
  }
}