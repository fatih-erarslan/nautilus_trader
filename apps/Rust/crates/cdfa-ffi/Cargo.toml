[package]
name = "cdfa-ffi"
version = "0.1.0"
edition = "2021"
rust-version = "1.70"
authors = ["TENGRI Trading Swarm <swarm@tengri.ai>"]
description = "Foreign Function Interface for Cross-Domain Feature Alignment"
repository = "https://github.com/tengri/ats-cp-trader"
license = "MIT OR Apache-2.0"
keywords = ["cdfa", "ffi", "c-api", "python", "bindings"]
categories = ["api-bindings", "ffi", "no-std"]

[dependencies]
# Core CDFA dependencies
cdfa-core = { path = "../cdfa-core", features = ["no_std"] }
cdfa-algorithms = { path = "../cdfa-algorithms", features = ["no_std"] }
cdfa-simd = { path = "../cdfa-simd", optional = true }
cdfa-parallel = { path = "../cdfa-parallel", optional = true }
cdfa-ml = { path = "../cdfa-ml", optional = true }

# FFI support
libc = "0.2"
once_cell = { workspace = true }

# Error handling
thiserror = { workspace = true }
anyhow = { workspace = true }

# Memory safety
parking_lot = { workspace = true }

# Logging (optional)
tracing = { workspace = true, optional = true }

# Python bindings (optional)
pyo3 = { version = "0.25.1", optional = true }
numpy = { version = "0.25", optional = true }

# Serialization (optional)
serde = { workspace = true, optional = true }
serde_json = { workspace = true, optional = true }
bincode = "1.3"

[build-dependencies]
cbindgen = { workspace = true }
cc = "1.0"

[dev-dependencies]
criterion = { workspace = true }
pretty_assertions = { workspace = true }
tempfile = { workspace = true }

[features]
default = ["c-api"]
c-api = []
python = ["pyo3", "numpy", "cdfa-ml", "logging"]
simd = ["cdfa-simd"]
parallel = ["cdfa-parallel"]
ml = ["cdfa-ml"]
logging = ["tracing"]
serde = ["dep:serde", "dep:serde_json", "cdfa-core/serde", "cdfa-algorithms/serde"]

[lib]
name = "cdfa_ffi"
crate-type = ["cdylib", "staticlib", "rlib"]
path = "src/lib.rs"

[[example]]
name = "c_example"
path = "examples/c_example.rs"
crate-type = ["bin"]

[[example]]
name = "python_example"
path = "examples/python_example.rs"
required-features = ["python"]

# Package metadata for cbindgen
[package.metadata.capi]
min_version = "0.9.0"
header_dir = "include"

# Python package configuration
[package.metadata.maturin]
name = "cdfa"
classifiers = [
    "Programming Language :: Rust",
    "Programming Language :: Python :: Implementation :: CPython",
    "Programming Language :: Python :: Implementation :: PyPy",
]